---
import { Image } from 'astro:assets'

import { PostPreview } from 'astro-pure/components/pages'
import { getBlogCollection } from 'astro-pure/server'
import { getSanityPosts } from '../lib/sanity'
import { Button, Card, Icon, Label } from 'astro-pure/user'
import PageLayout from '@/layouts/BaseLayout.astro'
import Section from '@/components/home/Section.astro'
import avatar from '@/assets/avatar.png'
import config from '@/site-config'
import ProjectSection from '@/components/projects/ProjectSection.astro'
import { getSanityProjects } from '../lib/sanity'

const projects = await getSanityProjects()

// const MAX_POSTS = 10
const allPosts = await getSanityPosts()
const allPostsByDate = [...allPosts].sort(
  (a, b) =>
    new Date(b.data.updatedDate ?? b.data.publishDate ?? 0).valueOf() -
    new Date(a.data.updatedDate ?? a.data.publishDate ?? 0).valueOf()
)
---

<PageLayout meta={{ title: 'Home' }}>
  <main class='flex w-full flex-col items-start md:w-3/4 lg:w-2/3 mx-auto'>
    <!-- Header Section with Avatar and Greeting -->
    <section class='animate mb-4 flex flex-row items-center gap-x-4 w-full' id='content-header'>
      <Image
        src={avatar}
        alt='profile'
        class='h-24 w-24 flex-shrink-0 rounded-full border p-1'
        loading='eager'
      />

      <div class='flex flex-col gap-y-1'>
        <h1 class='text-3xl font-bold'>Hey! I'm Ebube</h1>
        <p class='text-base text-foreground/70'>/ae·boo·bae/</p>
      </div>
    </section>

    <div id='content' class='animate flex flex-col gap-y-10 w-full'>
      <!-- About Section (no heading) -->
      <div class='flex flex-col gap-y-4'>
        <p class='text-base text-foreground/80'>
          I use data to solve problems. My work spans statistical modelling, machine learning, and software development, and I am drawn to projects rooted in real-world systems.
        </p>
        <Button title='More about me' class='w-fit' href='/about' variant='ahead' />
      </div>

      {
        allPostsByDate.slice(0, 3).length > 0 && (
          <Section title='Recent Posts' class='!flex-col !gap-y-3'>
            <ul class='flex flex-col gap-y-1.5 sm:gap-y-2'>
              {allPostsByDate.map((p) => (
                <li class='flex flex-col gap-x-2 sm:flex-row'>
                  <PostPreview post={p} />
                </li>
              ))}
            </ul>
            <Button title='More posts' class='w-fit' href='/blog' variant='ahead' />
          </Section>
        )
      }
      
      <Section title='Recent Projects' class='!flex-col !gap-y-5'>
        <ProjectSection
          projects={projects.slice(0, 5).map(p => ({
            name: p.data.title,
            description: p.data.description,
            image: p.data.image,
            links: [
              p.data.github && { type: 'github', href: p.data.github },
              p.data.liveSite && { type: 'site', href: p.data.liveSite }
            ].filter(Boolean)
          }))}
        />

    </div>
  </main>
</PageLayout>