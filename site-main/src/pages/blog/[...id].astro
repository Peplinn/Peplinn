---
import PostLayout from '@/layouts/BlogPost.astro'

import { PortableText } from 'astro-portabletext'
import { getSanityPosts, getHeadingsFromPortableText, urlFor } from '../../lib/sanity'

export const prerender = true

export async function getStaticPaths() {
  const posts = await getSanityPosts()
  
  return posts.map((post: any) => ({
    params: { id: post.slug }, 
    props: { post, posts }
  }))
}

type Props = {
  post: any
  posts: any[]
}

const { post, posts } = Astro.props

const headings = getHeadingsFromPortableText(post.body)

const portableTextComponents = {
  type: {
    image: ({ value }: any) => {
      const imgUrl = urlFor(value).width(800).url();
      return `<img src="${imgUrl}" alt="${value.alt || ''}" class="rounded-xl my-8 mx-auto shadow-sm" loading="lazy" />`;
    }
  }
};
---

<PostLayout {post} {posts} {headings} remarkPluginFrontmatter={{}}>
  <article class="prose prose-pure dark:prose-invert max-w-none transition-all">
    <PortableText value={post.body} components={portableTextComponents} />
  </article>
</PostLayout>