---
import { sanityClient } from "sanity:client";
import { PortableText } from "astro-portabletext";
import PageLayout from '@/layouts/ContentLayout.astro';
import DocsContents from './DocsContents.astro';

const QUERY = `*[_type == "essay" && slug.current == $slug][0]`;
const essay = await sanityClient.fetch(QUERY, Astro.params);

export async function getStaticPaths() {
  return sanityClient.fetch(`
    *[_type == "essay" && defined(slug.current)]{
      "params": { "slug": slug.current }
    }
  `);
}

const essays = await sanityClient.fetch(`*[_type == "essay" && defined(slug.current)]{
  title, slug, category, order
}`);
---
<PageLayout meta={{ title: essay.title, description: essay.description }} back='/essays'>
  <Fragment slot="sidebar">
    <DocsContents essays={essays} class="docs-toc block mt-3" />
  </Fragment>

  <Fragment slot="header">
    <h1 class="text-2xl font-medium sm:mb-2 sm:text-3xl">{essay.title}</h1>
    {essay.description && (
      <blockquote class="text-sm italic text-muted-foreground mt-2">
        <q>{essay.description}</q>
      </blockquote>
    )}
  </Fragment>

  <main class="prose mt-6 lg:mt-10">
    {Array.isArray(essay.content) ? (
      <PortableText value={essay.content} />
    ) : (
      <p>No content available.</p>
    )}
  </main>
</PageLayout>
